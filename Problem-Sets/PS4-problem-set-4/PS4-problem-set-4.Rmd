---
title: "PS4"
author: "Joseph Davis Chamdani"
date: "2025-11-03"
output: html_document
---

## **1 Preliminary analysis**

---

### **1.1 Load data. How many rows/columns are there?**
```{r}
library(readr)
library(dplyr)
library(ggplot2)

data <- read_delim("gapminder.csv")

nrow(data)
ncol(data)
```

---

### **1.2 Print a small sample of data. Does it look OK?**
```{r}
data %>% head(10)
```

--- 

### **1.3 What does a row in this dataset represent?**
Each row represents one country in a specific year, showing its demographic and economic data such as population, fertility rate, GDP, and life expectancy.


--- 

### **1.4 Show how the country names are written (print appropriate rows/columns) and ensure the output is easily readable**
```{r}
data %>%
  filter(grepl("Korea|Venezuela|Kingdom", name)) %>%
  select(name, iso3, iso2) %>%
  distinct() %>%
  arrange(name)
```

--- 

### **1.5 How many countries (name) were there in different continents (region) in year 2000?**
```{r}
data %>%
  filter(time == 2000, !is.na(region)) %>%
  group_by(region) %>%
  summarize(n_countries = n_distinct(name))
```

--- 

### **1.6 How many countries are there across years? (unique by iso3, iso2, and name)**
```{r}
data %>%
  summarize(
    n_names = n_distinct(name),
    n_iso2 = n_distinct(iso2, na.rm = TRUE),
    n_iso3 = n_distinct(iso3, na.rm = TRUE)
  )
```

--- 

### **1.7 Compare counts between iso3, iso2, and name. Which country (name) is missing an iso2 code?**
```{r}
data %>%
  filter(is.na(iso2)) %>%
  select(name, iso2, iso3) %>%
  distinct()
```
Only Namibia doesn’t have an iso2 code.

--- 

### **1.8 Why might Namibia be the one missing an iso2 code? Briefly explain.**
```{r}
data %>%
  filter(name == "Namibia") %>%
  select(name, time, iso2, iso3) %>%
  arrange(time) %>%
  head(15)
```

Namibia’s ISO2 code is "NA". When R reads the file, "NA" can be treated as a missing value, so Namibia appears to have no ISO2 code.

---

## **2 CO2 emissions**

---

### **2.1 Remove all lines that do not have valid CO2 per capita values. How many lines are left?**
```{r}
data_co2 <- data %>%
  filter(!is.na(co2_PC))
nrow(data_co2)
```

---

### **2.2 Make a plot of total CO2 emissions over time for U.S., China, India (+ a few others). Explain (a) why this plot type and (b) what it shows.**
```{r}
countries_plot <- c("United States of America", "China", "India", "Germany", "Indonesia", "Japan")

data_co2 %>%
  filter(name %in% countries_plot, !is.na(co2)) %>%
  ggplot(aes(x = time, y = co2, col = name)) +
  geom_line() +
  labs(
    title = "Total CO2 Emissions Over Time",
    x = "Year",
    y = "Total CO2 Emissions (kt)",
    col = "Country"
  )
```

a) I used a line plot because it clearly shows how emissions change over time for each country.
b) China's CO2 emissions exploded since the 1980s, far surpassing all other countries. The US, Germany, Japan, India, and Indonesia remained relatively stable in comparison, showing a major shift in global emissions from Western nations to rapidly industrializing Asian economies.

---

### **2.3 Make a similar plot for the same countries, but using CO2 per capita. What does this suggest?**
```{r}
data_co2 %>%
  filter(name %in% countries_plot, !is.na(co2_PC)) %>%
  ggplot(aes(x = time, y = co2_PC, col = name)) +
  geom_line() +
  labs(
    title = "CO2 Emissions Per Capita Over Time",
    x = "Year",
    y = "CO2 Per Capita (metric tons per person)",
    col = "Country"
  )
```

Per capita emissions shows a different story: the US emits far more per person (15-20 metric tons/person) than China (7 metric tons/person), despite China's higher total. This shows China's massive total is due to its large population, while Americans have much bigger individual carbon footprints. India and Indonesia remain very low at 1-2 metric tons per person

---

### **2.4 Compute average CO2 per capita by continent in 1960 and 2016. Comment on the result.**
```{r}
data_co2 %>%
  filter(time %in% c(1960, 2016), !is.na(co2_PC), !is.na(region)) %>%
  group_by(region, time) %>%
  summarize(avg_co2_PC = round(mean(co2_PC, na.rm = TRUE), 2)) %>%
  arrange(region, time)
```

Asia's emissions per person increased a lot (1.74 to 6.47) while the Americas decreased (7.15 to 4.80), showing emissions shifted from developed to developing countries.

---

### **2.5 Make a barplot of average CO2 per capita across continents (1960 vs 2016).**
```{r}
data_co2 %>%
  filter(time %in% c(1960, 2016), !is.na(co2_PC), !is.na(region)) %>%
  group_by(region, time) %>%
  summarize(avg_co2_PC = mean(co2_PC, na.rm = TRUE)) %>%
  ggplot(aes(x = region, y = avg_co2_PC, fill = factor(time))) +
  geom_col(position = "dodge") +
  labs(
    title = "Average CO2 Emissions Per Capita by Continent (1960 vs 2016)",
    x = "Continent",
    y = "Average CO2 Per Capita (metric tons per person)",
    fill = "Year"
  )
```

---

### **2.6 Is a barplot a good choice for 2.5? Explain.**
Yes, a bar plot works well here because it clearly compares the average CO2 emissions between continents and across two years. The side-by-side bars make it easy to see how emissions have increased or decreased over time without overcrowding the plot.

---

## **3 Life expectancy and total fertility**

---

### **3.1 Warming up with lag(): orange tree data**
#### **3.1.1 Load the orange tree data (Canvas files/data) and check it.**
```{r}
orange <- read_delim("orange-trees.csv")

head(orange)
glimpse(orange)
```

---

#### **3.1.2 Compute growth of Tree #1**
**(a) Filter to that tree**
```{r}
tree1 <- orange %>%
  filter(tree == 1)
tree1
```

**(b) Compute growth using lag()**
```{r}
tree1 <- tree1 %>%
  mutate(growth = circumference - lag(circumference))

tree1
```
**(c) Explain why growth at age 118 is NA**

Growth at age 118 is NA because there’s no earlier measurement to subtract from. 

**(d) Explain how growth at age 484 (28) is computed.**

Growth at age 484 is calculated as 58 - 30 = 28, the difference between the circumference at ages 484 and 118.

---

#### **3.1.3 Compute growth for each tree**
```{r}
orange <- orange %>%
  group_by(tree) %>%
  mutate(growth = circumference - lag(circumference))

orange
```
---

#### **3.1.4 Plot growth vs age for all trees, marking trees differently (color/line/point).**
```{r}
orange %>%
  filter(!is.na(growth)) %>%
  ggplot(aes(x = age, y = growth, col = factor(tree))) +
  geom_line() +
  geom_point() +
  labs(
    title = "Tree Growth Over Time",
    x = "Age (days)",
    y = "Growth in Circumference (mm)",
    col = "Tree"
  )
```

---

### **3.2 Life expectancy growth (LE vs fertility)**

#### **3.2.1 Remove rows with missing region, LE, and total fertility. How many lines remain?**
```{r}
data_life <- data %>%
  filter(!is.na(region), !is.na(lifeExpectancy), !is.na(fertilityRate))

nrow(data_life)
```

---

#### **3.2.2 Scatterplot (1960): total fertility vs life expectancy by country; size by country size, color by region. Comment.**
```{r}
data_life %>%
  filter(time == 1960) %>%
  ggplot(aes(x = lifeExpectancy, y = fertilityRate, 
             size = totalPopulation, col = region)) +
  geom_point(alpha = 0.7) +
  labs(
    title = "Total Fertility vs Life Expectancy (1960)",
    x = "Life Expectancy (years)",
    y = "Total Fertility Rate (births per woman)",
    size = "Population",
    col = "Continent"
  )
```

Countries with lower life expectancy in 1960 had more kids. Africa had low life expectancy and high fertility, while Europe had high life expectancy and low fertility. Bigger dots are countries with more people.

---

#### **3.2.3 Make a similar plot, but this time use 2019 data only.**
```{r}
data_life %>%
  filter(time == 2019) %>%
  ggplot(aes(x = lifeExpectancy, y = fertilityRate, 
             size = totalPopulation, col = region)) +
  geom_point(alpha = 0.7) +
  labs(
    title = "Total Fertility vs Life Expectancy (2019)",
    x = "Life Expectancy (years)",
    y = "Total Fertility Rate (births per woman)",
    size = "Population",
    col = "Continent"
  )
```

---

#### **3.2.4 Compare these two plots and comment what do you see. How has world changed through the last 60 years?**

Most countries moved from low life expectancy and high fertility in 1960 to high life expectancy and low fertility in 2019. African and Asian countries improved the most. Overall, people live longer and have fewer kids now.

---

#### **3.2.5 Compute average life expectancy for each continent in 1960 and 2019. Do results fit the figures?**
```{r}
data_life %>%
  filter(time %in% c(1960, 2019)) %>%
  group_by(region, time) %>%
  summarize(avg_life_exp = round(mean(lifeExpectancy, na.rm = TRUE), 1)) %>%
  arrange(region, time)
```

---

#### **3.2.6 Compute average LE growth 1960–2019 by continent. Order by growth and explain.**
```{r}
data_life %>%
  filter(time %in% c(1960, 2019)) %>%
  group_by(region, time) %>%
  summarize(avg_life_exp = mean(lifeExpectancy, na.rm = TRUE)) %>%
  group_by(region) %>%
  summarize(growth = round(avg_life_exp[time == 2019] - avg_life_exp[time == 1960], 1)) %>%
  arrange(desc(growth))
```

---

#### **3.2.7 Show trajectories on fertility–LE space for US, Sweden, China, and a few others.**
```{r}
countries_trajectory <- c("United States of America", "Sweden", "Indonesia", "Pakistan", "China", "India", "Nigeria")

data_life %>%
  filter(name %in% countries_trajectory) %>%
  arrange(name, time) %>%                        
  ggplot(aes(
    x = fertilityRate,
    y = lifeExpectancy,
    color = name,
    group = name
  )) +
  geom_path(linewidth = 1) +                   
  geom_point(size = 1.8) +
  labs(
    title = "Country Trajectories: Fertility vs Life Expectancy",
    x = "Total fertility rate ",
    y = "Life expectancy at birth",
    color = "Country"
  ) +
  scale_x_continuous(limits = c(2, 8)) +
  scale_y_continuous(limits = c(40, 80))


```

---

#### **3.2.8 What was the US ranking in life expectancy in 1960 and in 2019 (from top)?**
```{r}
data_life %>%
  filter(time %in% c(1960, 2019), !is.na(lifeExpectancy)) %>%
  group_by(time) %>%
  mutate(rank = rank(desc(lifeExpectancy))) %>% 
  filter(name == "United States of America") %>%
  select(name, time, lifeExpectancy, rank)
```
---

## **4 Access to electricity**

---

#### **4.1 Compute average access to electricity (accessElectricity) across all continents by each year. Display it as a adequately labeled good plot.**
```{r}
data %>%
  filter(!is.na(region), !is.na(accessElectricity)) %>%
  group_by(region, time) %>%
  summarize(avg_electricity = mean(accessElectricity, na.rm = TRUE)) %>%
  ggplot(aes(x = time, y = avg_electricity, col = region)) +
  geom_line() +
  geom_point() +
  labs(
    title = "Average Access to Electricity by Continent Over Time",
    x = "Year",
    y = "Access to Electricity (% of population)",
    col = "Continent"
  )
```

---

#### **4.2 If you did it correctly, you notice that electricity access is decreasing on most continents! What the heck is going on?**

```{r}
data %>%
  filter(region == "Oceania", !is.na(accessElectricity)) %>%
  group_by(time) %>%
  summarise(n_countries = n_distinct(name),
            avg_access = mean(accessElectricity, na.rm = TRUE),
            .groups = "drop")
```

The drop is not real. In the early years, the data only included countries like Australia and New Zealand, which both had full electricity access. Later on, more Pacific Island countries were added, and some of them had lower access. This made the average go down, even though access itself did not really decrease.

---

## **5 Extra Credits**

---

#### **5.1 Remove all missing child mortality and life expectancy values. How many rows are left?**

```{r}
data_mortality <- data %>%
  filter(!is.na(childMortality), !is.na(lifeExpectancy))

nrow(data_mortality)
```


---

#### **5.2 Pick 3-5 countries and make a trajectory plot of life expectancy versus child mortality. Choose such countries where you see not just smooth improvements, but also periods of deterioration through these years **

```{r}
countries_ec <- c("Rwanda","Cambodia","Afghanistan","China")


data_mortality %>%
  filter(name %in% countries_ec) %>%
  arrange(name, time) %>%
  ggplot(aes(x = childMortality, y = lifeExpectancy,
             col = factor(name), group = name)) +
  geom_path() +                      
  geom_point(size = 2) +              
  geom_point(                          
    data = . %>% filter(time %% 10 == 0),
    size = 3, shape = 21, fill = "white"
  ) +
  labs(
    title = "Child Mortality vs Life Expectancy",
    x = "Child Mortality",
    y = "Life Expectancy (years)",
    col = "Country"
  ) +
  scale_x_continuous(limits = c(0, 350)) +
  scale_y_continuous(limits = c(20, 80))
```


---


#### *It took me around 8-10 Hours to complete the PS4*



![](jo-sticker.PNG){width=19%}
