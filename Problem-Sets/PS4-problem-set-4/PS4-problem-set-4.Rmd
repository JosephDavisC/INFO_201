---
title: "PS4"
author: "Joseph Davis Chamdani"
date: "2025-11-03"
output: html_document
---

## **1 Preliminary analysis**

---

### **1.1 Load data. How many rows/columns are there?**
```{r}
library(readr)
library(dplyr)

data <- read_delim("gapminder.csv")

nrow(data)
ncol(data)
```

---

### **1.2 Print a small sample of data. Does it look OK?**
```{r}
head(data, 10)
```

--- 

### **1.3 What does a row in this dataset represent?**
Each row represents one country in a specific year, showing its demographic and economic data such as population, fertility rate, GDP, and life expectancy.


--- 

### **1.4 Show how the country names are written (print appropriate rows/columns) and ensure the output is easily readable**
```{r}
data %>%
  filter(grepl("Korea|Venezuela|United", name, ignore.case = TRUE)) %>%
  select(iso3, iso2, name, region, `sub-region`, `intermediate-region`) %>%
  distinct() %>%
  arrange(name)
```

--- 

### **1.5 How many countries (name) were there in different continents (region) in year 2000?**
```{r}
data %>%
  filter(time == 2000, !is.na(region)) %>%
  group_by(region) %>%
  summarise(num_countries = n_distinct(name)) %>%
  arrange(desc(num_countries))
```

--- 

### **1.6 How many countries are there across years? (unique by iso3, iso2, and name)**
```{r}
data %>%
  summarise(
    unique_name = n_distinct(name),
    unique_iso2 = n_distinct(iso2),
    unique_iso3 = n_distinct(iso3)
  )
```

--- 

### **1.7 Compare counts between iso3, iso2, and name. Which country (name) is missing an iso2 code?**
```{r}
data %>%
  filter(is.na(iso2)) %>%
  select(name, iso3, region) %>%
  distinct()
```
Only Namibia doesn’t have an iso2 code.

--- 

### **1.8 Why might Namibia be the one missing an iso2 code? Briefly explain.**
```{r}
data %>%
  filter(name == "Namibia") %>%
  select(name, iso3, iso2)
```
Namibia’s ISO-3 code is “NAM”, but its iso2 code is missing, I think it's likely a data issue or it wasn’t assigned properly in this dataset.

---

## **2 CO2 emissions**

---

### **2.1 Keep only rows with valid CO2 per capita values. How many lines are left?**
```{r}
data_co2 <- data %>%
  filter(!is.na(co2))
nrow(data_co2)
```

---

### **2.2 Make a plot of total CO2 emissions over time for U.S., China, India (+ a few others). Explain (a) why this plot type and (b) what it shows.**
```{r}
library(ggplot2)

data_co2 %>%
  filter(name %in% c("United States of America", "China", "India", "Brazil", "Germany")) %>%
  ggplot(aes(x = time, y = co2, color = name)) +
  geom_line() +
  labs(
    title = "Total CO2 Emissions Over Time",
    x = "Year",
    y = "Total CO2 Emissions (million tons)",
    color = "Country"
  )
```

a) I used a line plot because it clearly shows how emissions change over time for each country.
b) The plot shows that China’s emissions increased the most after 2000, while the U.S. stayed high but flat, and India keeps rising steadily.

---

### **2.3 Make a similar plot for the same countries, but using CO2 per capita. What does this suggest?**
```{r}
data_co2 %>%
  filter(name %in% c("United States of America", "China", "India", "Brazil", "Germany")) %>%
  ggplot(aes(x = time, y = co2_PC, color = name)) +
  geom_line() +
  labs(
    title = "CO2 Emissions Per Capita Over Time",
    x = "Year",
    y = "CO2 Emissions Per Capita (tons per person)",
    color = "Country"
  )
```

---

### **2.4 Compute average CO2 per capita by continent in 1960 and 2016. Comment on the result.**
```{r}
data_co2 %>%
  filter(time %in% c(1960, 2016), !is.na(region)) %>%
  group_by(region, time) %>%
  summarise(avg_co2 = mean(co2_PC, na.rm = TRUE)) %>%
  arrange(time, desc(avg_co2))
```

---

### **2.5 Make a barplot of average CO2 per capita across continents (1960 vs 2016).**
```{r}
data_co2 %>%
  filter(time %in% c(1960, 2016), !is.na(region)) %>%
  group_by(region, time) %>%
  summarise(avg_co2 = mean(co2_PC, na.rm = TRUE)) %>%
  ggplot(aes(x = region, y = avg_co2, fill = factor(time))) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8), color = "black") +
  scale_fill_manual(
    values = c("1960" = "#404076", "2016" = "#D8C999"),
    name = "Year"
  ) +
  labs(
    title = "Average CO2 Emissions Per Capita by Continent (1960 vs 2016)",
    x = "Continent",
    y = "Average CO2 per Capita"
  )
```

---

### **2.6 Is a barplot a good choice for 2.5? Explain.**
Yes, a bar plot works well here because it clearly compares the average CO2 emissions between continents and across two years. The side-by-side bars make it easy to see how emissions have increased or decreased over time without overcrowding the plot.

---

## **3 Life expectancy and total fertility**

---

### **3.1 Warming up with lag(): orange tree data**
#### **3.1.1 Load the orange tree data (Canvas files/data) and check it.**
```{r}
orange <- read_delim("orange-trees.csv")

nrow(orange)
ncol(orange)
head(orange)
```

#### **3.1.2 Compute growth of Tree #1**
**(a) Filter to that tree**
```{r}
tree1 <- orange %>%
  filter(tree == 1)
tree1
```

**(b) compute growth using lag()**
```{r}
tree1 <- tree1 %>%
  mutate(growth = circumference - lag(circumference))

tree1
```
**(c) explain why growth at age 118 is NA**

Growth at age 118 is NA because there’s no earlier measurement to subtract from. 

**(d) explain how growth at age 484 (28) is computed.**

Growth at age 484 is calculated as 58 - 30 = 28, the difference between the circumference at ages 484 and 118.

---

#### **3.1.3 Compute growth for each tree**
```{r}
orange_growth <- orange %>%
  group_by(tree) %>%
  mutate(growth = circumference - lag(circumference))

head(orange_growth)
```
---

#### **3.1.4 Plot growth vs age for all trees, marking trees differently (color/line/point).**
```{r}
ggplot(orange_growth, aes(x = age, y = growth, color = factor(tree))) +
  geom_line() +
  geom_point() +
  labs(
    title = "Growth vs Age for Each Orange Tree",
    x = "Age (days)",
    y = "Growth in Circumference",
    color = "Tree"
  )
```

---

### **3.2 Life expectancy growth (LE vs fertility)**

#### **3.2.1 Remove rows with missing region, LE, and total fertility. How many lines remain?**
```{r}
data_clean <- data %>%
  filter(!is.na(region), !is.na(lifeExpectancy), !is.na(fertilityRate))
nrow(data_clean)
```

---

#### **3.2.2 Scatterplot (1960): total fertility vs life expectancy by country; size by country size, color by region. Comment.**
```{r}
data_1960 <- data_clean %>%
  filter(time == 1960)

ggplot(data_1960, aes(x = fertilityRate, y = lifeExpectancy, 
                      color = region, size = totalPopulation)) +
  geom_point(alpha = 0.7) +
  labs(
    title = "Fertility vs Life Expectancy (1960)",
    x = "Total Fertility Rate (births per woman)",
    y = "Life Expectancy (years)",
    color = "Region",
    size = "Population"
  ) +
  theme_minimal()
```

---

#### **3.2.3 Scatterplot (2019): same as 3.2.2 but for 2019. Comment.**
```{r}
data_2019 <- data_clean %>%
  filter(time == 2019)

ggplot(data_2019, aes(x = fertilityRate, y = lifeExpectancy,
                      color = region, size = totalPopulation)) +
  geom_point(alpha = 0.7) +
  labs(
    title = "Fertility vs Life Expectancy (2019)",
    x = "Total Fertility Rate (births per woman)",
    y = "Life Expectancy (years)",
    color = "Region",
    size = "Population"
  ) +
  theme_minimal()
```

---

#### **3.2.4 Compare 1960 vs 2019 plots. What changed over ~60 years?**
In 1960, most countries had high fertility and low life expectancy, with clear regional separation.
By 2019, fertility rates dropped everywhere, and life expectancy increased globally.
Many countries that were once low-performing (especially in Asia and Africa) moved closer to developed nations.
Overall, the points shifted upward and left, showing progress in health and reduced birth rates.
---

#### **3.2.5 Compute average life expectancy for each continent in 1960 and 2019. Do results fit the figures?**
```{r}
data_clean %>%
  filter(time %in% c(1960, 2019), !is.na(region)) %>%
  group_by(region, time) %>%
  summarise(avg_LE = mean(lifeExpectancy, na.rm = TRUE)) %>%
  arrange(time, desc(avg_LE))
```

---

#### **3.2.6 Compute average LE growth 1960–2019 by continent. Order by growth and explain.**
```{r}
le_growth <- data_clean %>%
  group_by(region, time) %>%
  summarise(avg_LE = mean(lifeExpectancy, na.rm = TRUE)) %>%
  arrange(region, time) %>%
  mutate(growth = avg_LE - lag(avg_LE)) %>%
  filter(!is.na(growth)) %>%
  arrange(desc(growth))

le_growth
```

---

#### **3.2.7 Show trajectories on fertility–LE space for US, Sweden, China, and a few others.**
```{r}

countries <- c("United States of America", "Sweden", "China", "India", "Brazil")

data_clean %>%
  filter(name %in% countries) %>%
  ggplot(aes(x = fertilityRate, y = lifeExpectancy, color = name)) +
  geom_path(size = 1) +
  geom_point(size = 2, alpha = 0.6) +
  labs(
    title = "Fertility vs Life Expectancy Trajectories (1960–2019)",
    x = "Total Fertility Rate (births per woman)",
    y = "Life Expectancy at Birth (years)",
    color = "Country"
  ) +
  theme_minimal()
```

---

#### **3.2.8 What was the US ranking in life expectancy in 1960 and in 2019 (from top)?**
```{r}
rank_US <- data_clean %>%
  filter(time %in% c(1960, 2019), !is.na(lifeExpectancy)) %>%
  group_by(time) %>%
  mutate(rank = rank(-lifeExpectancy, ties.method = "first")) %>%
  filter(name == "United States of America") %>%
  select(time, lifeExpectancy, rank)

rank_US
```
---

## **4 Access to electricity**

---

#### **4.1 Compute average access to electricity (accessElectricity) across all continents by each year. Display it as a adequately labeled good plot.**
```{r}

```

---

#### **4.2 If you did it correctly, you notice that electricty access is decreasing on most continents! What the heck is going on?**

---

## **5 Extra Credits**

---

#### **5.1 Remove all missing child mortality and life expectancy values. How many rows are left?**

---

#### **Pick 3-5 countries and make a trajectory plot of life expectancy versus child mortality. Choose such countries where you see not just smooth improvements, but also periods of deterioration through these years **

